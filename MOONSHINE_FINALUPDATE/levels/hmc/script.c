#include <ultra64.h>
#include "sm64.h"
#include "behavior_data.h"
#include "model_ids.h"
#include "seq_ids.h"
#include "dialog_ids.h"
#include "segment_symbols.h"
#include "level_commands.h"

#include "game/level_update.h"

#include "levels/scripts.h"

#include "actors/common1.h"

#include "make_const_nonconst.h"
#include "levels/hmc/header.h"

const LevelScript level_hmc_entry[] = {
	INIT_LEVEL(),
	LOAD_MIO0(0x07, _hmc_segment_7SegmentRomStart, _hmc_segment_7SegmentRomEnd), 
	LOAD_MIO0_TEXTURE(0x09, _cave_mio0SegmentRomStart, _cave_mio0SegmentRomEnd), 
	LOAD_MIO0(0x05, _group6_mio0SegmentRomStart, _group6_mio0SegmentRomEnd), 
	LOAD_RAW(0x0C, _group6_geoSegmentRomStart, _group6_geoSegmentRomEnd), 
	LOAD_MIO0(0x06, _group17_mio0SegmentRomStart, _group17_mio0SegmentRomEnd), 
	LOAD_RAW(0x0D, _group17_geoSegmentRomStart, _group17_geoSegmentRomEnd), 
	LOAD_MIO0(0x08, _common0_mio0SegmentRomStart, _common0_mio0SegmentRomEnd), 
	LOAD_RAW(0x0F, _common0_geoSegmentRomStart, _common0_geoSegmentRomEnd), 
	LOAD_MIO0(0xa, _cloud_floor_skybox_mio0SegmentRomStart, _cloud_floor_skybox_mio0SegmentRomEnd), 
	ALLOC_LEVEL_POOL(),
	MARIO(MODEL_MARIO, 0x00000001, bhvMario), 
	JUMP_LINK(script_func_global_1), 
	JUMP_LINK(script_func_global_7), 
	JUMP_LINK(script_func_global_18), 
	LOAD_MODEL_FROM_GEO(MODEL_HMC_WOODEN_DOOR, wooden_door_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_HMC_METAL_DOOR, metal_door_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_HMC_HAZY_MAZE_DOOR, hazy_maze_door_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_HMC_METAL_PLATFORM, Mplatform_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_HMC_METAL_ARROW_PLATFORM, hmc_geo_0005B8), 
	LOAD_MODEL_FROM_GEO(MODEL_HMC_ELEVATOR_PLATFORM, hmc_geo_0005D0), 
	LOAD_MODEL_FROM_GEO(MODEL_HMC_ROLLING_ROCK, hmc_geo_000548), 
	LOAD_MODEL_FROM_GEO(MODEL_HMC_ROCK_PIECE, hmc_geo_000570), 
	LOAD_MODEL_FROM_GEO(MODEL_HMC_ROCK_SMALL_PIECE, hmc_geo_000588), 
	LOAD_MODEL_FROM_GEO(MODEL_HMC_RED_GRILLS, hmc_geo_000530), 
	LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, Pine1_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_WARP_PIPE, Pipe2_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_METAL_BOX, Cloud1_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_CHECKERBOARD_PLATFORM, Platform_1_geo), 

	AREA(1, hmc_area_1),
		WARP_NODE(0x0A, LEVEL_HMC, 0x01, 0x0A, WARP_NO_CHECKPOINT),
		WARP_NODE(0xF0, LEVEL_CASTLE, 0x01, 0x22, WARP_NO_CHECKPOINT),
		WARP_NODE(0xF1, LEVEL_CASTLE, 0x01, 0x24, WARP_NO_CHECKPOINT),
		WARP_NODE(0x0B, LEVEL_HMC, 0x01, 0x0C, WARP_NO_CHECKPOINT),
		WARP_NODE(0x0C, LEVEL_HMC, 0x01, 0x0B, WARP_NO_CHECKPOINT),
		WARP_NODE(0x0D, LEVEL_HMC, 0x01, 0x0E, WARP_NO_CHECKPOINT),
		WARP_NODE(0x0E, LEVEL_HMC, 0x01, 0x0D, WARP_NO_CHECKPOINT),
		WARP_NODE(0x01, LEVEL_HMC, 0x02, 0x02, WARP_NO_CHECKPOINT),
		WARP_NODE(0x0F, LEVEL_HMC, 0x02, 0x03, WARP_NO_CHECKPOINT),
		OBJECT(MODEL_BEE, 195, 474, 5041, 0, 19, 0, 0x00000000, bhvBee),
		OBJECT(MODEL_BEE, 933, 746, 3207, 0, 0, 0, 0x00000000, bhvBee),
		OBJECT(MODEL_BEE, 1158, 474, 2079, 0, 0, 0, 0x00000000, bhvBee),
		OBJECT_WITH_ACTS(MODEL_BEE, -1442, 2257, -1051, 0, 0, 0, 0x00000000, bhvBee, ACT_1 | ACT_2 | ACT_3),
		OBJECT(MODEL_BEE, -4591, 2257, -7, 0, 0, 0, 0x00000000, bhvBee),
		OBJECT_WITH_ACTS(MODEL_BEE, 4139, 4082, -1404, 0, 0, 0, 0x00000000, bhvBee, ACT_1 | ACT_2 | ACT_3),
		OBJECT_WITH_ACTS(MODEL_BEE, 7227, 4988, -3320, 0, 0, 0, 0x00000000, bhvBee, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_BEE, 1734, 474, 4660, 0, -33, 0, 0x00000000, bhvBee, ACT_1),
		OBJECT_WITH_ACTS(MODEL_CHUCKYA, 3838, 5973, 2326, 0, 0, 0, 0x00000000, bhvChuckya, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_CHUCKYA, -1748, 5973, 2326, 0, 0, 0, 0x00000000, bhvChuckya, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT(MODEL_FLYGUY, -5836, 1736, -2501, 0, 0, 0, 0x00000000, bhvFlyGuy),
		OBJECT_WITH_ACTS(MODEL_FLYGUY, -5836, 1736, -3652, 0, 0, 0, 0x00000000, bhvFlyGuy, ACT_2),
		OBJECT(MODEL_FLYGUY, -7139, 2283, -4187, 0, 0, 0, 0x00000000, bhvFlyGuy),
		OBJECT_WITH_ACTS(MODEL_FLYGUY, -7872, 2639, -3782, 0, 0, 0, 0x00000000, bhvFlyGuy, ACT_2),
		OBJECT_WITH_ACTS(MODEL_FLYGUY, 3278, 4376, -3789, 0, 0, 0, 0x00000000, bhvFlyGuy, ACT_1),
		OBJECT(MODEL_NONE, 390, 1272, -531, 0, 0, 0, 0x00000000, bhvGoombaTripletSpawner),
		OBJECT(MODEL_NONE, 4706, 1048, 6277, 0, 0, 0, 0x00000000, bhvGoombaTripletSpawner),
		OBJECT(MODEL_NONE, 1432, 991, 653, 0, 0, 0, 0x00000000, bhvGoombaTripletSpawner),
		OBJECT(MODEL_NONE, -7118, 822, 3069, 0, 0, 0, 0x00000000, bhvGoombaTripletSpawner),
		OBJECT(MODEL_NONE, -6824, 822, 978, 0, 0, 0, 0x00000000, bhvGoombaTripletSpawner),
		OBJECT(MODEL_NONE, 7107, 2548, 5652, 0, 0, 0, 0x00000000, bhvGoombaTripletSpawner),
		OBJECT(MODEL_NONE, 6157, 2420, -1403, 0, 0, 0, 0x00000000, bhvGoombaTripletSpawner),
		OBJECT(MODEL_NONE, 5733, 2420, -4146, 0, 0, 0, 0x00000000, bhvGoombaTripletSpawner),
		OBJECT(MODEL_HEART, 772, 5973, 2326, 0, 0, 0, 0x00000000, bhvRecoveryHeart),
		OBJECT_WITH_ACTS(MODEL_SNUFIT, -4017, 8377, 1283, 0, 0, 0, 0x00000000, bhvSnufit, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_SNUFIT, -3800, 8443, 1040, 0, 0, 0, 0x00000000, bhvSnufit, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_SNUFIT, -2625, 10281, 746, 0, 0, 0, 0x00000000, bhvSnufit, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT(MODEL_RED_COIN, -3196, 2560, -463, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, 2872, 1522, -1461, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -5536, 1378, 4881, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, 5961, 4291, 5045, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, 7460, 4890, -3032, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, 4706, 322, 4635, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, 51, 1094, 2028, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -6387, 1995, -3816, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT_WITH_ACTS(MODEL_METAL_BOX, 2271, 359, 4248, 0, 0, 0, 0x00000000, bhvPushableMetalBox, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_METAL_BOX, 3042, 690, 4614, 0, 0, 0, 0x00000000, bhvPushableMetalBox, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT(MODEL_YELLOW_COIN, 2854, 1147, -262, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -6723, 1207, -2346, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 2112, 1837, -2306, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -6101, 1452, -2610, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -5978, 1677, -3278, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -7081, 2262, -3822, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -7552, 2462, -3299, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -7406, 4485, -2618, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 5488, 1499, 6491, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 5488, 2040, 5610, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 6325, 3112, 4867, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 6325, 3525, 4169, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT_WITH_ACTS(MODEL_YELLOW_COIN, 2271, 534, 4248, 0, 0, 0, 0x00000000, bhvYellowCoin, ACT_2),
		OBJECT_WITH_ACTS(MODEL_YELLOW_COIN, 501, 477, 1272, 0, 0, 0, 0x00000000, bhvYellowCoin, ACT_2),
		OBJECT_WITH_ACTS(MODEL_YELLOW_COIN, -7313, 865, 1385, 0, 0, 0, 0x00000000, bhvYellowCoin, ACT_2),
		OBJECT(MODEL_HMC_HAZY_MAZE_DOOR, 79, 1260, 130, 0, 0, 0, 0x00000000, bhvDoor),
		OBJECT(MODEL_HMC_HAZY_MAZE_DOOR, -611, 2030, -1112, 0, -180, 0, 0x00000000, bhvDoor),
		OBJECT(MODEL_NONE, 4700, 756, 4646, 0, 0, 0, 0x00000000, bhvFish2),
		OBJECT(MODEL_CASTLE_GROUNDS_WARP_PIPE, 148, 2367, -1457, 0, 90, 0, 0x000B0000, bhvWarpPipe),
		OBJECT(MODEL_CASTLE_GROUNDS_WARP_PIPE, 3372, 3547, -618, 0, -180, 0, 0x000C0000, bhvWarpPipe),
		OBJECT(MODEL_CASTLE_GROUNDS_WARP_PIPE, 6419, 2342, -6017, 0, 0, 0, 0x000D0000, bhvWarpPipe),
		OBJECT(MODEL_CASTLE_GROUNDS_WARP_PIPE, -161, 9957, -6478, 0, 0, 0, 0x000E0000, bhvWarpPipe),
		OBJECT(MODEL_CASTLE_GROUNDS_WARP_PIPE, -3158, 2317, -4802, 0, 0, 0, 0x000F0000, bhvWarpPipe),
		OBJECT(MODEL_NONE, -3158, 2470, -4619, 0, 0, 0, 0x00010000, bhvSpinAirborneWarp),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, 6145, 4915, 2286, 0, 0, 0, 0x00000000, bhvCheckerboardElevatorGroup),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, -3545, 6549, 1943, 0, -90, 0, 0x00000000, bhvCheckerboardElevatorGroup),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, -4082, 7444, 1943, 0, -90, 0, 0x00000000, bhvCheckerboardElevatorGroup),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, -3486, 8932, 1150, 0, 180, 0, 0x00000000, bhvCheckerboardElevatorGroup),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, 6985, 2869, -229, 0, -180, 0, 0x00000000, bhvCheckerboardElevatorGroup),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, 6985, 3788, -700, 0, -180, 0, 0x00000000, bhvCheckerboardElevatorGroup),
		OBJECT_WITH_ACTS(MODEL_YELLOW_COIN, 2731, 6286, -5344, 0, 0, 0, 0x00000000, bhvYellowCoin, ACT_6),
		OBJECT(MODEL_YELLOW_COIN, 6887, 3900, 2819, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, 47, 377, 2031, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, -7555, 821, 2483, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, -6386, 821, 1151, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, -7520, 821, 324, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, -6439, 821, -1653, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, -7722, 821, -1955, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, -6564, 821, 3453, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, -4381, 1666, 6215, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, -4286, 8214, 1014, 0, 0, 0, 0x01000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, 6995, 2378, -1410, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, 6995, 2378, -970, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, 5175, 2355, -5031, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, -2401, 10144, 1447, 0, 0, 0, 0x01000000, bhvTree),
		OBJECT_WITH_ACTS(MODEL_STAR, 2731, 6286, -5344, 0, 0, 0, 0x01000000, bhvStar, ACT_1 | ACT_2 | ACT_3 | ACT_4 | ACT_5),
		OBJECT_WITH_ACTS(MODEL_STAR, 661, 10383, -6002, 0, 0, 0, 0x02000000, bhvStar, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT(MODEL_NONE, -3873, 1983, 5901, 0, 0, 0, 0x03000000, bhvHiddenRedCoinStar),
		OBJECT_WITH_ACTS(MODEL_STAR, -2647, 10513, 1123, 0, 0, 0, 0x04000000, bhvStar, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT(MODEL_MOLINE, 12039, 10036, -4515, 0, 0, 0, 0x00000000, bhvMoline),
		OBJECT(MODEL_NONE, 768, 1015, 7208, 0, -180, 0, 0x000A0000, bhvSpinAirborneWarp),
		MARIO_POS(0x01, -180, 768, 1015, 7208),
		TERRAIN(hmc_area_1_collision),
		MACRO_OBJECTS(hmc_area_1_macro_objs),
        SET_BACKGROUND_MUSIC(/*settingsPreset*/ 0x0004, /*seq*/ SEQ_STREAMED_GUSTY),
		TERRAIN_TYPE(TERRAIN_STONE),
	END_AREA(),

	AREA(2, hmc_area_2),
		WARP_NODE(0x02, LEVEL_HMC, 0x01, 0x01, WARP_NO_CHECKPOINT),
		WARP_NODE(0x03, LEVEL_HMC, 0x02, 0x03, WARP_NO_CHECKPOINT),
		WARP_NODE(0xF0, LEVEL_CASTLE, 0x01, 0x22, WARP_NO_CHECKPOINT),
		WARP_NODE(0xF1, LEVEL_CASTLE, 0x01, 0x24, WARP_NO_CHECKPOINT),
		OBJECT(MODEL_BEE, -4317, 1057, -554, 0, -37, 0, 0x00000000, bhvBee),
		OBJECT(MODEL_BEE, -726, 1057, 3247, 0, 0, 0, 0x00000000, bhvBee),
		OBJECT(MODEL_BEE, -738, 1045, 1124, 0, -117, 0, 0x00000000, bhvBee),
		OBJECT(MODEL_BEE, -1694, 1057, 4994, 0, 0, 0, 0x00000000, bhvBee),
		OBJECT(MODEL_FLYGUY, -2623, 1057, -142, 0, -90, 0, 0x00000000, bhvFlyGuy),
		OBJECT(MODEL_FLYGUY, -3110, 1057, 4869, 0, 180, 0, 0x00000000, bhvFlyGuy),
		OBJECT(MODEL_GOOMBA, -6984, 827, 79, 0, 0, 0, 0x00000000, bhvGoomba),
		OBJECT(MODEL_BEE, -2188, 1057, 1172, 0, -138, 0, 0x00000000, bhvBee),
		OBJECT(MODEL_YELLOW_COIN, -7234, 832, 988, 0, -180, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_NONE, -7209, 939, 402, 0, 90, 0, 0x00030000, bhvSpinAirborneWarp),
		OBJECT(MODEL_MOLINE, 2545, 4041, 11462, 0, -91, 0, 0x00000000, bhvMoline),
		OBJECT(MODEL_CASTLE_GROUNDS_WARP_PIPE, -7437, 777, 402, 0, -180, 0, 0x00020000, bhvWarpPipe),
		OBJECT(MODEL_HMC_METAL_PLATFORM, -6000, 624, 421, 0, 0, 0, 0x00000000, bhvControllablePlatform),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, -4644, 804, 4259, 0, -90, 0, 0x00020000, bhvCheckerboardPlatformSub),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, -5745, 804, 4259, 0, -90, 0, 0x00020000, bhvCheckerboardPlatformSub),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, -7827, 761, 827, 0, -180, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_CASTLE_GROUNDS_BUBBLY_TREE, -6960, 974, 4804, 0, -180, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_RED_COIN, -4610, 799, -525, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -2105, 799, 1420, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -2044, 896, 3388, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -6956, 1588, 4805, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_NONE, -7512, 1242, 4264, 0, -180, 0, 0x05000000, bhvHiddenRedCoinStar),
		TERRAIN(hmc_area_2_collision),
		MACRO_OBJECTS(hmc_area_2_macro_objs),
        SET_BACKGROUND_MUSIC(/*settingsPreset*/ 0x0004, /*seq*/ SEQ_STREAMED_GUSTY),
		TERRAIN_TYPE(TERRAIN_GRASS),
	END_AREA(),

	FREE_LEVEL_POOL(),
	MARIO_POS(0x01, -180, 768, 1015, 7208),
	CALL(0, lvl_init_or_update),
	CALL_LOOP(1, lvl_init_or_update),
	CLEAR_LEVEL(),
	SLEEP_BEFORE_EXIT(1),
	EXIT(),
};
