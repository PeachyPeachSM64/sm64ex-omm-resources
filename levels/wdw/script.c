#include <ultra64.h>
#include "sm64.h"
#include "behavior_data.h"
#include "model_ids.h"
#include "seq_ids.h"
#include "dialog_ids.h"
#include "segment_symbols.h"
#include "level_commands.h"

#include "game/level_update.h"

#include "levels/scripts.h"

#include "actors/common1.h"

#include "make_const_nonconst.h"
#include "levels/wdw/header.h"

const LevelScript level_wdw_entry[] = {
	INIT_LEVEL(),
	LOAD_MIO0(0x07, _wdw_segment_7SegmentRomStart, _wdw_segment_7SegmentRomEnd), 
	LOAD_MIO0_TEXTURE(0x09, _grass_mio0SegmentRomStart, _grass_mio0SegmentRomEnd), 
	LOAD_MIO0(0x0A, _bidw_skybox_mio0SegmentRomStart, _bidw_skybox_mio0SegmentRomEnd), 
	LOAD_MIO0(0x05, _group1_mio0SegmentRomStart, _group1_mio0SegmentRomEnd), 
	LOAD_RAW(0x0C, _group1_geoSegmentRomStart, _group1_geoSegmentRomEnd), 
	LOAD_MIO0(0x06, _group13_mio0SegmentRomStart, _group13_mio0SegmentRomEnd), 
	LOAD_RAW(0x0D, _group13_geoSegmentRomStart, _group13_geoSegmentRomEnd), 
	LOAD_MIO0(0x08, _common0_mio0SegmentRomStart, _common0_mio0SegmentRomEnd), 
	LOAD_RAW(0x0F, _common0_geoSegmentRomStart, _common0_geoSegmentRomEnd), 
	LOAD_MIO0(0xb, _effect_mio0SegmentRomStart, _effect_mio0SegmentRomEnd), 
	ALLOC_LEVEL_POOL(),
	MARIO(MODEL_MARIO, 0x00000001, bhvMario), 
	JUMP_LINK(script_func_global_1), 
	JUMP_LINK(script_func_global_2), 
	JUMP_LINK(script_func_global_14), 
	LOAD_MODEL_FROM_GEO(MODEL_WDW_SQUARE_FLOATING_PLATFORM, wdw_geo_000580), 
	LOAD_MODEL_FROM_GEO(MODEL_WDW_ARROW_LIFT, Flagy_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_WDW_WATER_LEVEL_DIAMOND, RockCplatform_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_WDW_HIDDEN_PLATFORM, BPlatformU_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_WDW_EXPRESS_ELEVATOR, wdw_geo_000610), 
	LOAD_MODEL_FROM_GEO(MODEL_WDW_RECTANGULAR_FLOATING_PLATFORM, wdw_geo_000628), 
	LOAD_MODEL_FROM_GEO(MODEL_WDW_ROTATING_PLATFORM, GreenCplatform_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_BOB_BUBBLY_TREE, Btree_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_CHECKERBOARD_PLATFORM, BPlatform_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_WARP_PIPE, warp_pipe_geo), 

	AREA(1, wdw_area_1),
		WARP_NODE(0x0A, LEVEL_WDW, 0x01, 0x0A, WARP_NO_CHECKPOINT),
		WARP_NODE(0xF0, LEVEL_CASTLE, 0x01, 0x14, WARP_NO_CHECKPOINT),
		WARP_NODE(0xF1, LEVEL_CASTLE, 0x01, 0x15, WARP_NO_CHECKPOINT),
		WARP_NODE(0x0C, LEVEL_WDW, 0x02, 0x0F, WARP_NO_CHECKPOINT),
		WARP_NODE(0x0D, LEVEL_WDW, 0x02, 0x0E, WARP_NO_CHECKPOINT),
		WARP_NODE(0x1A, LEVEL_WDW, 0x02, 0x1D, WARP_NO_CHECKPOINT),
		WARP_NODE(0x1B, LEVEL_WDW, 0x02, 0x1C, WARP_NO_CHECKPOINT),
		OBJECT(MODEL_BEE, 4463, -6071, 6498, 0, 90, 0, 0x00000000, bhvBee),
		OBJECT(MODEL_BEE, 2838, -2473, -210, 0, 90, 0, 0x00000000, bhvBee),
		OBJECT(MODEL_FLYGUY, 3353, -2977, -718, 0, 53, 0, 0x00000000, bhvFlyGuy),
		OBJECT(MODEL_BEE, 5605, -5187, 2081, 0, 0, 0, 0x00000000, bhvBee),
		OBJECT(MODEL_BEE, 6215, -5187, 503, 0, 0, 0, 0x00000000, bhvBee),
		OBJECT(MODEL_BLACK_BOBOMB, 6694, -5465, -2649, 0, 0, 0, 0x00000000, bhvBobomb),
		OBJECT(MODEL_BLACK_BOBOMB, 6316, -5108, -6561, 0, 0, 0, 0x00000000, bhvBobomb),
		OBJECT(MODEL_CASTLE_GROUNDS_WARP_PIPE, 7347, -4815, -6603, 0, 0, 0, 0x000C0000, bhvWarpPipe),
		OBJECT(MODEL_NONE, 7347, -4667, -6377, 0, 0, 0, 0x000D0000, bhvSpinAirborneWarp),
		OBJECT(MODEL_CASTLE_GROUNDS_WARP_PIPE, -4595, -6491, -4653, 0, 0, 0, 0x001A0000, bhvWarpPipe),
		OBJECT(MODEL_NONE, -4595, -6343, -4427, 0, 0, 0, 0x001B0000, bhvSpinAirborneWarp),
		OBJECT(MODEL_NONE, 5909, -7302, 4571, 0, 0, 0, 0x00000000, bhvGoombaTripletSpawner),
		OBJECT(MODEL_NONE, 6247, -5690, 935, 0, 0, 0, 0x00000000, bhvGoombaTripletSpawner),
		OBJECT(MODEL_NONE, 5038, -4266, 291, 0, 0, 0, 0x00000000, bhvGoombaTripletSpawner),
		OBJECT(MODEL_GOOMBA, -4397, -6468, -3989, 0, 0, 0, 0x00000000, bhvGoomba),
		OBJECT(MODEL_GOOMBA, -4397, -6208, -2325, 0, 0, 0, 0x00000000, bhvGoomba),
		OBJECT(MODEL_GOOMBA, -4843, -6208, -1142, 0, 0, 0, 0x00000000, bhvGoomba),
		OBJECT(MODEL_GOOMBA, -4439, -6448, 337, 0, 0, 0, 0x00000000, bhvGoomba),
		OBJECT(MODEL_GOOMBA, -4859, -6208, -2852, 0, 0, 0, 0x00000000, bhvGoomba),
		OBJECT(MODEL_WDW_ARROW_LIFT, -6245, -5284, 3366, 0, 0, 0, 0x004E0000, bhvPoleGrabbing),
		OBJECT(MODEL_BREAKABLE_BOX, 4978, -6492, 5885, 0, 90, 0, 0x00000000, bhvBreakableBox),
		OBJECT(MODEL_BREAKABLE_BOX, 4198, -5684, 1880, 0, 90, 0, 0x00000000, bhvBreakableBox),
		OBJECT(MODEL_BREAKABLE_BOX, -4971, -6488, -3401, 0, 90, 0, 0x00000000, bhvBreakableBox),
		OBJECT(MODEL_BREAKABLE_BOX, -4130, -6321, 814, 0, 90, 0, 0x00000000, bhvBreakableBox),
		OBJECT(MODEL_BREAKABLE_BOX, -4130, -6321, 1023, 0, 90, 0, 0x00000000, bhvBreakableBox),
		OBJECT(MODEL_YELLOW_COIN, -6276, -5210, 1088, 0, -90, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -6276, -5066, 1591, 0, -90, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -6276, -4855, 2066, 0, -90, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -5051, -5820, 2023, 0, -90, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -5051, -5443, 1172, 0, -90, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 5851, -4478, 1268, 0, -90, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 7281, -6453, -5921, 0, -90, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 6198, -6453, -5468, 0, -90, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 5878, -5323, -6796, 0, -90, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_RED_COIN, 4977, -6395, 5884, 0, -90, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, 6615, -5205, 2549, 0, -90, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, 5305, -3688, -382, 0, -90, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, 7218, -6366, -5209, 0, -90, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -4971, -6412, -3401, 0, -90, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -4114, -5734, -2163, 0, -90, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -4129, -6249, 1023, 0, -90, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -7007, -4839, 403, 0, -90, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, 4623, -6403, 4609, 0, 90, 0, 0x00000000, bhvCheckerboardElevatorGroup),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, 5851, -4762, 1264, 0, -90, 0, 0x00000000, bhvCheckerboardPlatformSub),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, -5054, -6030, 2022, 0, -90, 0, 0x00000000, bhvCheckerboardPlatformSub),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, -5054, -5713, 1166, 0, -90, 0, 0x00000000, bhvCheckerboardPlatformSub),
		OBJECT(MODEL_WDW_ROTATING_PLATFORM, 6718, -5726, -1325, 0, 0, 0, 0x46010000, bhvRotatingPlatform),
		OBJECT(MODEL_WDW_ROTATING_PLATFORM, 6718, -5726, -3971, 0, 0, 0, 0x46010000, bhvRotatingPlatform),
		OBJECT(MODEL_BOB_BUBBLY_TREE, 7249, -7302, 7303, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_BOB_BUBBLY_TREE, 6408, -7302, 7303, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_BOB_BUBBLY_TREE, 7373, -7313, 4150, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_BOB_BUBBLY_TREE, 6950, -5686, 1720, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_BOB_BUBBLY_TREE, 5302, -4319, -381, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_BOB_BUBBLY_TREE, -4254, -6484, -416, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_BOB_BUBBLY_TREE, -5000, -6484, -4902, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_BOB_BUBBLY_TREE, -7007, -5422, 404, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_BOB_BUBBLY_TREE, -5452, -5422, 3650, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_BOB_BUBBLY_TREE, -5452, -5422, 3132, 0, 0, 0, 0x00000000, bhvTree),
		OBJECT(MODEL_STAR, -6245, -4178, 3366, 0, 0, 0, 0x00000000, bhvStar),
		OBJECT(MODEL_STAR, 2947, -2211, -845, 0, 0, 0, 0x01000000, bhvStar),
		OBJECT(MODEL_NONE, -6954, -5135, 3243, 0, 0, 0, 0x03000000, bhvHiddenRedCoinStar),
		OBJECT(MODEL_NONE, 6999, -6867, 5611, 0, -90, 0, 0x000A0000, bhvSpinAirborneWarp),
		MARIO_POS(0x01, -90, 6999, -6867, 5611),
		TERRAIN(wdw_area_1_collision),
		MACRO_OBJECTS(wdw_area_1_macro_objs),
        SET_BACKGROUND_MUSIC(/*settingsPreset*/ 0x0000, /*seq*/ SEQ_STREAMED_LAND),
		TERRAIN_TYPE(TERRAIN_STONE),
	END_AREA(),

	AREA(2, wdw_area_2),
		WARP_NODE(0x0E, LEVEL_WDW, 0x01, 0x0D, WARP_NO_CHECKPOINT),
		WARP_NODE(0x0F, LEVEL_WDW, 0x02, 0x0F, WARP_NO_CHECKPOINT),
		WARP_NODE(0x1C, LEVEL_WDW, 0x01, 0x1B, WARP_NO_CHECKPOINT),
		WARP_NODE(0x1D, LEVEL_WDW, 0x01, 0x1A, WARP_NO_CHECKPOINT),
		WARP_NODE(0xF0, LEVEL_CASTLE, 0x01, 0x14, WARP_NO_CHECKPOINT),
		WARP_NODE(0xF1, LEVEL_CASTLE, 0x01, 0x15, WARP_NO_CHECKPOINT),
		OBJECT(MODEL_WDW_WATER_LEVEL_DIAMOND, 2740, 5589, 1645, 0, 90, 0, 0x46010000, bhvRotatingPlatform),
		OBJECT(MODEL_WDW_WATER_LEVEL_DIAMOND, -490, 5373, 6071, 0, 90, 0, 0x46010000, bhvRotatingPlatform),
		OBJECT(MODEL_WDW_WATER_LEVEL_DIAMOND, -1311, 5202, 6071, 0, 90, 0, 0x46010000, bhvRotatingPlatform),
		OBJECT(MODEL_NONE, -2147, 5522, 6014, 0, 90, 0, 0x001D0000, bhvSpinAirborneWarp),
		OBJECT(MODEL_RED_FLAME, 5220, 2775, -2162, 0, -90, 0, 0x000F0000, bhvFlame),
		OBJECT(MODEL_RED_FLAME, 5220, 2775, -841, 0, -90, 0, 0x000F0000, bhvFlame),
		OBJECT(MODEL_RED_FLAME, 3541, 3135, -479, 0, -90, 0, 0x000F0000, bhvFlame),
		OBJECT(MODEL_RED_FLAME, 1698, 4544, -1963, 0, -90, 0, 0x000F0000, bhvFlame),
		OBJECT(MODEL_RED_FLAME, 2432, 4544, 290, 0, -90, 0, 0x000F0000, bhvFlame),
		OBJECT(MODEL_RED_FLAME, 864, 5933, 1231, 0, -90, 0, 0x000F0000, bhvFlame),
		OBJECT(MODEL_RED_FLAME, 366, 4749, 3366, 0, -90, 0, 0x000F0000, bhvFlame),
		OBJECT(MODEL_RED_FLAME, 247, 5646, 6489, 0, -90, 0, 0x000F0000, bhvFlame),
		OBJECT(MODEL_RED_FLAME, 238, 5646, 5676, 0, -90, 0, 0x000F0000, bhvFlame),
		OBJECT(MODEL_CASTLE_GROUNDS_WARP_PIPE, 6338, 2447, -1506, 0, 0, 0, 0x000E0000, bhvWarpPipe),
		OBJECT(MODEL_NONE, 6074, 2687, -1506, 0, -90, 0, 0x000F0000, bhvSpinAirborneWarp),
		OBJECT(MODEL_CASTLE_GROUNDS_WARP_PIPE, -2419, 5346, 6013, 0, -90, 0, 0x001C0000, bhvWarpPipe),
		OBJECT(MODEL_WDW_HIDDEN_PLATFORM, 4413, 2565, -1151, 0, 90, 0, 0x00000000, bhvCheckerboardPlatformSub),
		OBJECT(MODEL_WDW_HIDDEN_PLATFORM, 977, 4194, -1668, 0, -90, 0, 0x00000000, bhvCheckerboardPlatformSub),
		OBJECT(MODEL_WDW_HIDDEN_PLATFORM, 1283, 5034, 872, 0, -180, 0, 0x00000000, bhvCheckerboardPlatformSub),
		OBJECT(MODEL_NONE, 673, 5653, 6065, 0, -90, 0, 0x02000000, bhvHiddenStar),
		OBJECT(MODEL_YELLOW_COIN, 4413, 2818, -1151, 0, 90, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 1555, 4024, 6561, 0, 90, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_FLYGUY, 774, 4520, -869, 0, 90, 0, 0x00000000, bhvFlyGuy),
		OBJECT(MODEL_FLYGUY, -1526, 5658, 6406, 0, 101, 0, 0x00000000, bhvFlyGuy),
		OBJECT(MODEL_GOOMBONE, 2966, 2835, -910, 0, 90, 0, 0x00000000, bhvgoombone),
		OBJECT(MODEL_GOOMBONE, 2457, 2856, -777, 0, 90, 0, 0x00000000, bhvgoombone),
		OBJECT(MODEL_GOOMBONE, 2184, 4271, -227, 0, 90, 0, 0x00000000, bhvgoombone),
		OBJECT(MODEL_GOOMBONE, 1509, 4661, 505, 0, 90, 0, 0x00000000, bhvgoombone),
		OBJECT(MODEL_GOOMBONE, 1669, 5670, 1760, 0, 90, 0, 0x00000000, bhvgoombone),
		OBJECT(MODEL_GOOMBONE, 1221, 5670, 1356, 0, 90, 0, 0x00000000, bhvgoombone),
		OBJECT(MODEL_BLACK_BOBOMB, 1000, 4500, 3935, 0, 90, 0, 0x00000000, bhvBobomb),
		OBJECT(MODEL_GOOMBONE, 787, 5389, 5879, 0, 90, 0, 0x00000000, bhvgoombone),
		OBJECT(MODEL_GOOMBONE, 1838, 4954, 5960, 0, 90, 0, 0x00000000, bhvgoombone),
		OBJECT(MODEL_BLACK_BOBOMB, 1779, 4500, 4776, 0, 90, 0, 0x00000000, bhvBobomb),
		TERRAIN(wdw_area_2_collision),
		MACRO_OBJECTS(wdw_area_2_macro_objs),
		SET_BACKGROUND_MUSIC(/*settingsPreset*/ 0x0004, /*seq*/ SEQ_STREAMED_UNDERGROUND),
		TERRAIN_TYPE(TERRAIN_STONE),
	END_AREA(),

	FREE_LEVEL_POOL(),
	MARIO_POS(0x01, -90, 6999, -6867, 5611),
	CALL(0, lvl_init_or_update),
	CALL_LOOP(1, lvl_init_or_update),
	CLEAR_LEVEL(),
	SLEEP_BEFORE_EXIT(1),
	EXIT(),
};
